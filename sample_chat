<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIZARYON - Test Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>

<style>
    body { background-color: #111827; color: #f3f4f6; }
    .red-bg { background-color: #dc2626; }
    .dark-gray-bg { background-color: #1f2937; }
    .red-text { color: #dc2626; }
    .chat-bubble { border-radius: 20px; max-width: 80%; }
    .user-bubble { background-color: #dc2626; color: white; margin-left: auto; }
    .ai-bubble { background-color: #374151; color: white; margin-right: auto; }
    .chat-container { height: calc(100vh - 260px); }
    .disclaimer { font-size: 13px; color: #9ca3af; text-align: center; margin-top: 10px; }
    .input-focus:focus { outline: none; box-shadow: 0 0 0 3px rgba(220,38,38,0.12); border-color: #dc2626; }
</style>
</head>
<body>

<nav class="dark-gray-bg shadow-lg sticky top-0 z-50">
    <div class="container mx-auto px-6 py-3 flex justify-between items-center">
        <div class="flex items-center space-x-4">
            <i data-feather="message-square" class="red-text"></i>
            <span class="text-xl font-bold">VIZARYON (Sample Chat)</span>
        </div>

        <button onclick="window.location.href='signup.html'" class="text-gray-300 hover:text-white">
            <i data-feather="user-plus"></i>
        </button>
    </div>
</nav>

<div class="container mx-auto px-6 py-4">
    <div class="chat-container overflow-y-auto mb-4">
        <div class="flex flex-col space-y-4" id="chatContent"></div>
    </div>

    <div class="dark-gray-bg rounded-lg p-4 shadow-lg">
        <div class="flex items-center">
            <input id="messageInput" type="text" placeholder="Ask something..."
            class="flex-grow px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg input-focus">

            <button id="sendBtn" class="red-bg ml-4 p-3 rounded-lg hover:bg-red-700 transition">
                <i data-feather="send" class="text-white"></i>
            </button>
        </div>
        <p class="disclaimer">VIZARYON ai may produce inaccurate information.</p>
    </div>
</div>


<script>
feather.replace();

const MAX_MESSAGES = 20;
let messages = JSON.parse(localStorage.getItem("demoChat")) || [];

const chatContent = document.getElementById("chatContent");
const input = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");

renderChat();

sendBtn.addEventListener("click", handleMessage);
input.addEventListener("keydown", e => { if (e.key === "Enter") handleMessage(); });

async function handleMessage() {
    if (messages.filter(m => m.role === "user").length >= MAX_MESSAGES) {
        lockChat();
        return;
    }

    const text = input.value.trim();
    if (!text) return;

    messages.push({ role: "user", text });
    input.value = "";
    saveAndRender();

    const reply = await generateAI(text);
    messages.push({ role: "ai", text: reply });
    saveAndRender();
}

function saveAndRender() {
    localStorage.setItem("demoChat", JSON.stringify(messages));
    renderChat();

    if (messages.filter(m => m.role === "user").length >= MAX_MESSAGES) {
        lockChat();
    }
}

function renderChat() {
    chatContent.innerHTML = "";
    messages.forEach(msg => {
        const el = document.createElement("div");
        el.className = `${msg.role === "user" ? "user-bubble" : "ai-bubble"} chat-bubble p-4 w-3/4`;

        el.innerHTML = msg.role === "ai"
            ? `<div class="flex items-center mb-2"><div class="red-bg p-2 rounded-full mr-2"><i data-feather="cpu" class="text-white"></i></div><span class="font-bold">VIZARYON ai</span></div><p>${escapeHtml(msg.text)}</p>`
            : `<p>${escapeHtml(msg.text)}</p>`;

        chatContent.appendChild(el);
    });

    feather.replace();
    chatContent.scrollTop = chatContent.scrollHeight;
}

function escapeHtml(text) {
    return text.replace(/[&<>"']/g, m => ({
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#039;"
    })[m]);
}


// ---------- REAL AI FUNCTION (OpenAI model) ----------
async function generateAI(userInput) {
    const API_KEY = "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";

    try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${API_KEY}`
            },
            body: JSON.stringify({
                model: "gpt-4o-mini",
                messages: [
                    { role: "system", content: "You are VIZARYON AI. Respond short, helpful, smart, and natural." },
                    { role: "user", content: userInput }
                ]
            })
        });

        const data = await response.json();
        return data.choices?.[0]?.message?.content || "‚ö†Ô∏è Error: No response received.";

    } catch (err) {
        return "‚ö†Ô∏è Network or API Error.";
    }
}


// ---------- LOCK MODE ----------
function lockChat() {
    chatContent.innerHTML += `
        <div class="ai-bubble chat-bubble p-4 w-3/4 text-center">
            <strong>üö´ Limit Reached</strong><br>
            To continue chatting, please create an account.
            <br><br>
            <button onclick="window.location.href='signup.html'" 
            class="red-bg px-4 py-2 rounded-lg mt-2 hover:bg-red-700">
                Sign Up Now
            </button>
        </div>
    `;
    input.disabled = true;
    sendBtn.disabled = true;
}
</script>

</body>
</html>
