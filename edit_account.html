<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIZARYON</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>

    <style>
        body { background-color: #111827; color: #f3f4f6; }
        .red-text { color: #dc2626; }
        .red-bg { background-color: #dc2626; }

        .toast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background-color: #1f2937; border: 1px solid #10b981; color: #10b981;
            padding: 12px 20px; border-radius: 8px; display: none;
        }
        .delete-toast { border-color: #dc2626; color: #dc2626; }

        input, textarea {
            background-color: #1f2937;
            border: 1px solid #374151;
        }
        input:focus, textarea:focus { border-color: #dc2626; outline: none; }
    </style>
</head>

<body class="min-h-screen px-6">

<div id="toast" class="toast"></div>

<nav class="fixed top-0 left-0 w-full shadow-md px-6 py-4 flex justify-between items-center z-50">
    <div class="flex items-center space-x-3">
        <i data-feather="edit-3" class="red-text"></i>
        <span class="text-xl font-bold">Edit Account</span>
    </div>
    <button onclick="window.location.href='settings.html'"
        class="border border-red-600 text-red-400 px-5 py-2 rounded-lg hover:bg-red-900 transition">
        Back
    </button>
</nav>

<section class="container mx-auto pt-28 max-w-xl">

    <div class="text-center mb-10">
        <div id="profilePreview"
             class="mx-auto bg-gray-600 w-24 h-24 rounded-full flex items-center justify-center text-3xl font-bold overflow-hidden">
            ðŸ‘¤
        </div>
        <input type="file" id="fileInput" accept="image/*" class="hidden">
        <button onclick="document.getElementById('fileInput').click()"
            class="mt-4 border border-gray-600 px-5 py-2 rounded-lg hover:bg-gray-700 transition">
            Change Profile Picture
        </button>
    </div>

    <div class="space-y-6">

        <div>
            <label class="text-gray-300 text-sm">Display Name</label>
            <input id="name" type="text" class="w-full px-4 py-3 rounded-lg mt-2">
        </div>

        <div>
            <label class="text-gray-300 text-sm">Username</label>
            <input id="username" type="text" maxlength="18"
                   class="w-full px-4 py-3 rounded-lg mt-2">
            <p id="usernameWarning" class="text-red-400 text-sm mt-1 hidden"></p>
        </div>

        <div>
            <label class="text-gray-300 text-sm">Email</label>
            <input id="email" type="email" class="w-full px-4 py-3 rounded-lg mt-2">
        </div>

        <div>
            <label class="text-gray-300 text-sm">Bio</label>
            <textarea id="bio"
                class="w-full px-4 py-3 rounded-lg mt-2 h-28 bg-gray-800 border border-gray-600"></textarea>
        </div>

    </div>

    <button onclick="saveProfile()"
        class="w-full mt-10 py-3 rounded-lg text-lg font-semibold red-bg hover:bg-red-700 transition">
        Save Changes
    </button>

</section>

<script>
feather.replace();

const nameInput = document.getElementById("name");
const usernameInput = document.getElementById("username");
const emailInput = document.getElementById("email");
const bioInput = document.getElementById("bio");
const usernameWarning = document.getElementById("usernameWarning");

/* ðŸ”¹ LOAD ACCOUNT DETAILS */
window.onload = () => {
    nameInput.value = localStorage.getItem("name") || "";
    usernameInput.value = localStorage.getItem("username") || "";
    emailInput.value = localStorage.getItem("email") || "";
    bioInput.value = localStorage.getItem("bio") || "";

    const img = localStorage.getItem("profilePic");
    if (img) {
        profilePreview.innerHTML = `<img src="${img}" class="w-full h-full object-cover rounded-full">`;
    }
};

/* ðŸ”¹ USERNAME RULES + AUTO LOWERCASE */
usernameInput.addEventListener("input", () => {
    let value = usernameInput.value.toLowerCase();
    usernameInput.value = value;

    if (!/^[a-z0-9_]*$/.test(value)) {
        showUsernameWarning("The following character is not supported!");
        return;
    }

    hideUsernameWarning();
});

/* ðŸ”¹ SAVE PROFILE WITH 14-DAY USERNAME LOCK */
function saveProfile() {
    const oldUsername = localStorage.getItem("username");
    const newUsername = usernameInput.value.trim();

    const lastChange = Number(localStorage.getItem("usernameChangedAt") || 0);
    const now = Date.now();
    const DAYS_14 = 14 * 24 * 60 * 60 * 1000;

    if (oldUsername && newUsername !== oldUsername) {
        if (now - lastChange < DAYS_14) {
            const daysLeft = Math.ceil((DAYS_14 - (now - lastChange)) / (24*60*60*1000));
            showUsernameWarning(`You can change username again in ${daysLeft} day(s).`);
            return;
        }
        localStorage.setItem("usernameChangedAt", now);
    }

    localStorage.setItem("name", nameInput.value);
    localStorage.setItem("username", newUsername);
    localStorage.setItem("email", emailInput.value);
    localStorage.setItem("bio", bioInput.value);

    showToast("Profile Updated Successfully!");
}

/* ðŸ”¹ TOAST */
function showToast(msg) {
    const toast = document.getElementById("toast");
    toast.textContent = msg;
    toast.style.display = "block";
    setTimeout(() => toast.style.display = "none", 2500);
}

function showUsernameWarning(msg) {
    usernameWarning.textContent = msg;
    usernameWarning.classList.remove("hidden");
}

function hideUsernameWarning() {
    usernameWarning.classList.add("hidden");
}

/* ðŸ”¹ PROFILE PICTURE */
document.getElementById("fileInput").addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        localStorage.setItem("profilePic", reader.result);
        profilePreview.innerHTML =
            `<img src="${reader.result}" class="w-full h-full object-cover rounded-full">`;
    };
    reader.readAsDataURL(file);
});
</script>

</body>
</html>    bioInput.value = localStorage.getItem("bio") || "";

    const img = localStorage.getItem("profilePic");
    if (img) {
        profilePreview.innerHTML = `<img src="${img}" class="w-full h-full object-cover rounded-full">`;
    }
};

/* ðŸ”¹ USERNAME RULES + AUTO LOWERCASE */
usernameInput.addEventListener("input", () => {
    let value = usernameInput.value.toLowerCase();
    usernameInput.value = value;

    if (!/^[a-z0-9_]*$/.test(value)) {
        showUsernameWarning("The following character is not supported!");
        return;
    }

    hideUsernameWarning();
});

/* ðŸ”¹ SAVE PROFILE WITH 14-DAY USERNAME LOCK */
function saveProfile() {
    const oldUsername = localStorage.getItem("username");
    const newUsername = usernameInput.value.trim();

    const lastChange = Number(localStorage.getItem("usernameChangedAt") || 0);
    const now = Date.now();
    const DAYS_14 = 14 * 24 * 60 * 60 * 1000;

    if (oldUsername && newUsername !== oldUsername) {
        if (now - lastChange < DAYS_14) {
            const daysLeft = Math.ceil((DAYS_14 - (now - lastChange)) / (24*60*60*1000));
            showUsernameWarning(`You can change username again in ${daysLeft} day(s).`);
            return;
        }
        localStorage.setItem("usernameChangedAt", now);
    }

    localStorage.setItem("name", nameInput.value);
    localStorage.setItem("username", newUsername);
    localStorage.setItem("email", emailInput.value);
    localStorage.setItem("bio", bioInput.value);

    showToast("Profile Updated Successfully!");
}

/* ðŸ”¹ TOAST */
function showToast(msg) {
    const toast = document.getElementById("toast");
    toast.textContent = msg;
    toast.style.display = "block";
    setTimeout(() => toast.style.display = "none", 2500);
}

function showUsernameWarning(msg) {
    usernameWarning.textContent = msg;
    usernameWarning.classList.remove("hidden");
}

function hideUsernameWarning() {
    usernameWarning.classList.add("hidden");
}

/* ðŸ”¹ PROFILE PICTURE */
document.getElementById("fileInput").addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        localStorage.setItem("profilePic", reader.result);
        profilePreview.innerHTML =
            `<img src="${reader.result}" class="w-full h-full object-cover rounded-full">`;
    };
    reader.readAsDataURL(file);
});
</script>

</body>
</html>            <div>
                <label class="text-gray-300 text-sm">Email</label>
                <input id="email" type="email" placeholder="user@email.com" class="w-full px-4 py-3 rounded-lg mt-2">
            </div>

            <div>
                <label class="text-gray-300 text-sm">Bio</label>
                <textarea id="bio" placeholder="Write something about you..." class="w-full px-4 py-3 rounded-lg mt-2 h-28 bg-gray-800 border border-gray-600"></textarea>
            </div>

        </div>

        <!-- Save Button -->
        <button onclick="saveProfile()" class="w-full mt-10 py-3 rounded-lg text-lg font-semibold red-bg hover:bg-red-700 transition">
            Save Changes
        </button>

        <!-- Delete Button -->
        <button onclick="deleteAccount()" class="w-full mt-4 py-3 text-red-400 border border-red-600 rounded-lg hover:bg-red-900 hover:text-white transition">
            Delete Account
        </button>
    </section>

<script>
feather.replace();

// Load user data
window.onload = () => {
    document.getElementById("name").value = localStorage.getItem("name") || "";
    document.getElementById("username").value = localStorage.getItem("username") || "";
    document.getElementById("email").value = localStorage.getItem("email") || "";
    document.getElementById("bio").value = localStorage.getItem("bio") || "";

    const savedImg = localStorage.getItem("profilePic");
    const preview = document.getElementById("profilePreview");

    if (savedImg) {
        preview.innerHTML = `<img src="${savedImg}" class="w-full h-full object-cover rounded-full"/>`;
    }
};

function showToast(message, error=false){
    const toast = document.getElementById("toast");
    toast.innerText = message;
    toast.style.display = "block";
    error ? toast.classList.add("delete-toast") : toast.classList.remove("delete-toast");
    setTimeout(() => toast.style.display = "none", 2500);
}

// Save profile
function saveProfile(){
    localStorage.setItem("name", document.getElementById("name").value);
    localStorage.setItem("username", document.getElementById("username").value);
    localStorage.setItem("email", document.getElementById("email").value);
    localStorage.setItem("bio", document.getElementById("bio").value);
    showToast("Profile Updated Successfully!");
}

// Delete logic
function deleteAccount() {
    document.getElementById("deleteModal1").style.display = "flex";
}

function stepTwoDelete() {
    document.getElementById("deleteModal1").style.display = "none";
    document.getElementById("deleteModal2").style.display = "flex";
}

function finalDelete() {
    if (!document.getElementById("confirmPassword").value.trim()) return showToast("Password Required", true);

    localStorage.clear();
    closeModals();
    showToast("Account Deleted Successfully", true);

    setTimeout(() => window.location.href = "index.html", 1500);
}

function closeModals() {
    document.getElementById("deleteModal1").style.display = "none";
    document.getElementById("deleteModal2").style.display = "none";
}

// Profile Picture Preview
document.getElementById("fileInput").addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        localStorage.setItem("profilePic", reader.result);
        document.getElementById("profilePreview").innerHTML = `<img src="${reader.result}" class="w-full h-full object-cover rounded-full"/>`;
    };
    reader.readAsDataURL(file);
});
</script>

</body>
</html>
