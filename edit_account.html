<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIZARYON â€“ Edit Account</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/feather-icons"></script>

<style>
  body {
    background-color: #111827;
    color: #f3f4f6;
  }

  input, textarea {
    background-color: #1f2937;
    border: 1px solid #374151;
  }

  input:focus, textarea:focus {
    border-color: #dc2626;
    outline: none;
  }

  .toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: #1f2937;
    border: 1px solid #10b981;
    color: #10b981;
    padding: 12px 20px;
    border-radius: 8px;
    display: none;
    z-index: 100;
  }
</style>
</head>

<body class="min-h-screen px-6">

<div id="toast" class="toast"></div>

<!-- NAV -->
<nav class="fixed top-0 left-0 w-full px-6 py-4 bg-gray-900 shadow z-50 flex justify-between items-center">
  <div class="flex items-center gap-3">
    <i data-feather="edit-3" class="text-red-500"></i>
    <span class="text-xl font-bold">Edit Account</span>
  </div>
  <button onclick="location.href='admin.html'"
    class="border border-red-600 text-red-400 px-4 py-2 rounded-lg hover:bg-red-900 transition">
    Back
  </button>
</nav>

<!-- CONTENT -->
<section class="container mx-auto pt-28 max-w-xl">

  <!-- PROFILE -->
  <div class="text-center mb-10">
    <div id="profilePreview"
      class="mx-auto w-24 h-24 rounded-full bg-gray-600 flex items-center justify-center text-3xl overflow-hidden">
      ðŸ‘¤
    </div>

    <input type="file" id="fileInput" accept="image/*" class="hidden">

    <button onclick="fileInput.click()"
      class="mt-4 border border-gray-600 px-5 py-2 rounded-lg hover:bg-gray-700">
      Change Profile Picture
    </button>
  </div>

  <!-- FORM -->
  <div class="space-y-6">

    <div>
      <label class="text-sm text-gray-300">Display Name</label>
      <input id="name" class="w-full px-4 py-3 rounded-lg mt-2">
    </div>

    <div>
      <label class="text-sm text-gray-300">Username</label>
      <input id="username" maxlength="18"
        class="w-full px-4 py-3 rounded-lg mt-2">
      <p id="usernameWarning" class="text-red-400 text-sm mt-1 hidden"></p>
    </div>

    <div>
      <label class="text-sm text-gray-300">Email</label>
      <input id="email" type="email"
        class="w-full px-4 py-3 rounded-lg mt-2">
    </div>

    <div>
      <label class="text-sm text-gray-300">Bio</label>
      <textarea id="bio"
        class="w-full px-4 py-3 rounded-lg mt-2 h-28"></textarea>
    </div>

  </div>

  <button onclick="saveProfile()"
    class="w-full mt-10 py-3 rounded-lg bg-red-600 hover:bg-red-700 font-semibold">
    Save Changes
  </button>

</section>

<!-- SCRIPT (SEALED â€“ NO LEAK) -->
<script>
feather.replace();

const nameInput = document.getElementById("name");
const usernameInput = document.getElementById("username");
const emailInput = document.getElementById("email");
const bioInput = document.getElementById("bio");
const profilePreview = document.getElementById("profilePreview");
const usernameWarning = document.getElementById("usernameWarning");
const toast = document.getElementById("toast");
const fileInput = document.getElementById("fileInput");

/* LOAD */
window.onload = () => {
  nameInput.value = localStorage.getItem("name") || "";
  usernameInput.value = localStorage.getItem("username") || "";
  emailInput.value = localStorage.getItem("email") || "";
  bioInput.value = localStorage.getItem("bio") || "";

  const img = localStorage.getItem("profilePic");
  if (img) {
    profilePreview.innerHTML =
      '<img src="' + img + '" class="w-full h-full object-cover rounded-full">';
  }
};

/* USERNAME RULES */
usernameInput.addEventListener("input", () => {
  const value = usernameInput.value.toLowerCase();
  usernameInput.value = value;

  if (!/^[a-z0-9_]*$/.test(value)) {
    showUsernameWarning("Only aâ€“z, 0â€“9 and _ allowed");
  } else {
    hideUsernameWarning();
  }
});

/* SAVE */
function saveProfile() {
  const oldUsername = localStorage.getItem("username");
  const newUsername = usernameInput.value.trim();

  const last = Number(localStorage.getItem("usernameChangedAt") || 0);
  const now = Date.now();
  const LOCK = 14 * 24 * 60 * 60 * 1000;

  if (oldUsername && newUsername !== oldUsername && now - last < LOCK) {
    const days = Math.ceil((LOCK - (now - last)) / 86400000);
    showUsernameWarning(`Username locked for ${days} day(s)`);
    return;
  }

  if (newUsername !== oldUsername) {
    localStorage.setItem("usernameChangedAt", now);
  }

  localStorage.setItem("name", nameInput.value);
  localStorage.setItem("username", newUsername);
  localStorage.setItem("email", emailInput.value);
  localStorage.setItem("bio", bioInput.value);

  showToast("Profile updated successfully");
}

/* TOAST */
function showToast(msg) {
  toast.textContent = msg;
  toast.style.display = "block";
  setTimeout(() => toast.style.display = "none", 2500);
}

function showUsernameWarning(msg) {
  usernameWarning.textContent = msg;
  usernameWarning.classList.remove("hidden");
}

function hideUsernameWarning() {
  usernameWarning.classList.add("hidden");
}

/* PROFILE PIC */
fileInput.addEventListener("change", () => {
  const file = fileInput.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    localStorage.setItem("profilePic", reader.result);
    profilePreview.innerHTML =
      '<img src="' + reader.result + '" class="w-full h-full object-cover rounded-full">';
  };
  reader.readAsDataURL(file);
});
</script>

</body>
</html>
